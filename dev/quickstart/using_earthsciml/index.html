<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Using EarthSciML ¬∑ EarthSciML</title><meta name="title" content="Using EarthSciML ¬∑ EarthSciML"/><meta property="og:title" content="Using EarthSciML ¬∑ EarthSciML"/><meta property="twitter:title" content="Using EarthSciML ¬∑ EarthSciML"/><meta name="description" content="Documentation for EarthSciML."/><meta property="og:description" content="Documentation for EarthSciML."/><meta property="twitter:description" content="Documentation for EarthSciML."/><meta property="og:url" content="earthsci.dev/quickstart/using_earthsciml/"/><meta property="twitter:url" content="earthsci.dev/quickstart/using_earthsciml/"/><link rel="canonical" href="earthsci.dev/quickstart/using_earthsciml/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="EarthSciML logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">EarthSciML</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../getting_started/">Overview</a></li><li><a class="tocitem" href="../prepare_environment/">Preparing Your Environment</a></li><li><a class="tocitem" href="../using_mtk/">Using ModelingToolkit</a></li><li class="is-active"><a class="tocitem" href>Using EarthSciML</a><ul class="internal"><li><a class="tocitem" href="#Model-Components"><span>Model Components</span></a></li><li><a class="tocitem" href="#Coupling-Model-Components"><span>Coupling Model Components</span></a></li><li class="toplevel"><a class="tocitem" href="#External-Data"><span>External Data</span></a></li><li><a class="tocitem" href="#Box-Model-Simulation"><span>Box Model Simulation</span></a></li><li><a class="tocitem" href="#3D-Model-Simulation"><span>3D Model Simulation</span></a></li><li><a class="tocitem" href="#Next-Steps"><span>Next Steps</span></a></li></ul></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/overview/">Overview</a></li><li><a class="tocitem" href="../../examples/scenario_analysis/">Scenario Analysis</a></li></ul></li><li><span class="tocitem">Libraries</span><ul><li><a class="tocitem" href="../../libraries/overview/">Overview</a></li><li><a class="tocitem" href="../../libraries/base/">üîó EarthSciMLBase.jl</a></li><li><a class="tocitem" href="../../libraries/gaschem/">üîó GasChem.jl</a></li><li><a class="tocitem" href="../../libraries/aerosol/">üîó Aerosol.jl</a></li><li><a class="tocitem" href="../../libraries/deposition/">üîó AtmosphericDeposition.jl</a></li><li><a class="tocitem" href="../../libraries/transport/">üîó EnvironmentalTransport.jl</a></li><li><a class="tocitem" href="../../libraries/data/">üîó EarthSciData.jl</a></li></ul></li><li><span class="tocitem">EarthSci EDU</span><ul><li><a class="tocitem" href="../../edu/overview/">Overview</a></li><li><a class="tocitem" href="../../edu/atmos_chem/">Atmospheric Chemistry</a></li></ul></li><li><a class="tocitem" href="../../contributing/">Contributing</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Getting Started</a></li><li class="is-active"><a href>Using EarthSciML</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Using EarthSciML</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/EarthSciML/earthsci.dev" title="View the repository on GitHub"><span class="docs-icon fa-brands">ÔÇõ</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/EarthSciML/earthsci.dev/blob/main/src/quickstart/using_earthsciml.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid">ÔÅÑ</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Using-EarthSciML"><a class="docs-heading-anchor" href="#Using-EarthSciML">Using EarthSciML</a><a id="Using-EarthSciML-1"></a><a class="docs-heading-anchor-permalink" href="#Using-EarthSciML" title="Permalink"></a></h1><p>As we saw in <a href="../using_mtk/#Using-ModelingToolkit">Using ModelingToolkit</a>, keeping track of variables and equations when working with complex models can be a challenge. EarthSciML is designed to streamline this process in the case of geoscientific model by providing utilities for coupling model components together and running them, and also by providing reference implementations of standard model components that can be used as building blocks to create larger-scale geoscientific models.</p><h2 id="Model-Components"><a class="docs-heading-anchor" href="#Model-Components">Model Components</a><a id="Model-Components-1"></a><a class="docs-heading-anchor-permalink" href="#Model-Components" title="Permalink"></a></h2><p>EarthSciML model components are ModelingToolkit <code>ODESystems</code> which contain metadata which specifies how each component should be coupled to other components.</p><p>So, for example, we can create an instance of the <a href="https://gaschem.earthsci.dev/stable/superfast/">SuperFast</a> gas-phase chemistry model model from the <a href="https://gaschem.earthsci.dev/stable/">GasChem</a> package like this:</p><pre><code class="language-julia hljs">using GasChem

chem = SuperFast()</code></pre><p class="math-container">\[ \begin{align}
\frac{\mathrm{d} \mathtt{O3}\left( t \right)}{\mathrm{d}t} &amp;= \mathtt{jNO2} \mathtt{NO2}\left( t \right) - \mathtt{jO32OH} \mathtt{O3}\left( t \right) - \mathtt{ISOP}\left( t \right) \mathtt{O3}\left( t \right) \mathtt{arrhenius21.k}\left( t \right) - \mathtt{NO}\left( t \right) \mathtt{O3}\left( t \right) \mathtt{arrhenius6.k}\left( t \right) - \mathtt{O3}\left( t \right) \mathtt{arrhenius2.k}\left( t \right) \mathtt{HO2}\left( t \right) - \mathtt{O3}\left( t \right) \mathtt{OH}\left( t \right) \mathtt{arrhenius1.k}\left( t \right) \\
\frac{\mathrm{d} \mathtt{OH}\left( t \right)}{\mathrm{d}t} &amp;= \mathtt{jCH3OOH} \mathtt{CH3OOH}\left( t \right) + 2 \mathtt{jH2O2} \mathtt{H2O2}\left( t \right) + 2 \mathtt{jO32OH} \mathtt{O3}\left( t \right) - \mathtt{CH4} \mathtt{arrhenius9.k}\left( t \right) \mathtt{OH}\left( t \right) - \mathtt{ISOP}\left( t \right) \mathtt{arrhenius18.k}\left( t \right) \mathtt{OH}\left( t \right) - 0.5 \mathtt{ISOP}\left( t \right) \mathtt{arrhenius20.k}\left( t \right) \mathtt{OH}\left( t \right) - \mathtt{ISOP}\left( t \right) \mathtt{OH}\left( t \right) \mathtt{arrhenius19.k}\left( t \right) + \mathtt{arrhenius7.k}\left( t \right) \mathtt{NO}\left( t \right) \mathtt{HO2}\left( t \right) - \mathtt{rate\_OHCO10.k}\left( t \right) \mathtt{OH}\left( t \right) \mathtt{CO}\left( t \right) - \mathtt{H2O2}\left( t \right) \mathtt{OH}\left( t \right) \mathtt{arrhenius5.k}\left( t \right) - \mathtt{NO2}\left( t \right) \mathtt{arr\_3rdbody8.k}\left( t \right) \mathtt{OH}\left( t \right) - \mathtt{arrhenius11.k}\left( t \right) \mathtt{OH}\left( t \right) \mathtt{CH2O}\left( t \right) - \mathtt{CH3OOH}\left( t \right) \mathtt{OH}\left( t \right) \mathtt{arrhenius13.k}\left( t \right) + \mathtt{O3}\left( t \right) \mathtt{arrhenius2.k}\left( t \right) \mathtt{HO2}\left( t \right) - \mathtt{O3}\left( t \right) \mathtt{OH}\left( t \right) \mathtt{arrhenius1.k}\left( t \right) - \mathtt{arrhenius3.k}\left( t \right) \mathtt{OH}\left( t \right) \mathtt{HO2}\left( t \right) \\
\frac{\mathrm{d} \mathtt{HO2}\left( t \right)}{\mathrm{d}t} &amp;= 2 \mathtt{jCH2Oa} \mathtt{CH2O}\left( t \right) + \mathtt{jCH3OOH} \mathtt{CH3OOH}\left( t \right) + 0.06 \mathtt{ISOP}\left( t \right) \mathtt{O3}\left( t \right) \mathtt{arrhenius21.k}\left( t \right) - \mathtt{arrhenius7.k}\left( t \right) \mathtt{NO}\left( t \right) \mathtt{HO2}\left( t \right) + \mathtt{rate\_OHCO10.k}\left( t \right) \mathtt{OH}\left( t \right) \mathtt{CO}\left( t \right) + 0.8 \left( \mathtt{CH3O2}\left( t \right) \right)^{2} \mathtt{arrhenius16.k}\left( t \right) + \mathtt{CH3O2}\left( t \right) \mathtt{NO}\left( t \right) \mathtt{arrhenius15.k}\left( t \right) - \mathtt{CH3O2}\left( t \right) \mathtt{HO2}\left( t \right) \mathtt{arrhenius12.k}\left( t \right) + \mathtt{H2O2}\left( t \right) \mathtt{OH}\left( t \right) \mathtt{arrhenius5.k}\left( t \right) + \mathtt{arrhenius11.k}\left( t \right) \mathtt{OH}\left( t \right) \mathtt{CH2O}\left( t \right) - \mathtt{O3}\left( t \right) \mathtt{arrhenius2.k}\left( t \right) \mathtt{HO2}\left( t \right) + \mathtt{O3}\left( t \right) \mathtt{OH}\left( t \right) \mathtt{arrhenius1.k}\left( t \right) - \mathtt{arrhenius3.k}\left( t \right) \mathtt{OH}\left( t \right) \mathtt{HO2}\left( t \right) - 2 \left( \mathtt{HO2}\left( t \right) \right)^{2} \mathtt{rate\_HO2HO24.k}\left( t \right) \\
\frac{\mathrm{d} \mathtt{H2O}\left( t \right)}{\mathrm{d}t} &amp;= \mathtt{CH4} \mathtt{arrhenius9.k}\left( t \right) \mathtt{OH}\left( t \right) + \mathtt{H2O2}\left( t \right) \mathtt{OH}\left( t \right) \mathtt{arrhenius5.k}\left( t \right) - \mathtt{H2O}\left( t \right) \mathtt{NO2}\left( t \right) \mathtt{rateconvert17.k}\left( t \right) + \mathtt{arrhenius11.k}\left( t \right) \mathtt{OH}\left( t \right) \mathtt{CH2O}\left( t \right) + \mathtt{arrhenius14.k}\left( t \right) \mathtt{CH3OOH}\left( t \right) \mathtt{OH}\left( t \right) + \mathtt{CH3OOH}\left( t \right) \mathtt{OH}\left( t \right) \mathtt{arrhenius13.k}\left( t \right) + \mathtt{arrhenius3.k}\left( t \right) \mathtt{OH}\left( t \right) \mathtt{HO2}\left( t \right) \\
\frac{\mathrm{d} \mathtt{NO}\left( t \right)}{\mathrm{d}t} &amp;= \mathtt{jNO2} \mathtt{NO2}\left( t \right) - \mathtt{arrhenius7.k}\left( t \right) \mathtt{NO}\left( t \right) \mathtt{HO2}\left( t \right) - \mathtt{CH3O2}\left( t \right) \mathtt{NO}\left( t \right) \mathtt{arrhenius15.k}\left( t \right) - \mathtt{NO}\left( t \right) \mathtt{O3}\left( t \right) \mathtt{arrhenius6.k}\left( t \right) \\
\frac{\mathrm{d} \mathtt{NO2}\left( t \right)}{\mathrm{d}t} &amp;=  - \mathtt{jNO2} \mathtt{NO2}\left( t \right) + \mathtt{arrhenius7.k}\left( t \right) \mathtt{NO}\left( t \right) \mathtt{HO2}\left( t \right) + \mathtt{CH3O2}\left( t \right) \mathtt{NO}\left( t \right) \mathtt{arrhenius15.k}\left( t \right) - \mathtt{H2O}\left( t \right) \mathtt{NO2}\left( t \right) \mathtt{rateconvert17.k}\left( t \right) + \mathtt{NO}\left( t \right) \mathtt{O3}\left( t \right) \mathtt{arrhenius6.k}\left( t \right) - \mathtt{NO2}\left( t \right) \mathtt{arr\_3rdbody8.k}\left( t \right) \mathtt{OH}\left( t \right) \\
\frac{\mathrm{d} \mathtt{CH3O2}\left( t \right)}{\mathrm{d}t} &amp;= \mathtt{CH4} \mathtt{arrhenius9.k}\left( t \right) \mathtt{OH}\left( t \right) + 2 \mathtt{ISOP}\left( t \right) \mathtt{arrhenius18.k}\left( t \right) \mathtt{OH}\left( t \right) + 1.86 \mathtt{ISOP}\left( t \right) \mathtt{O3}\left( t \right) \mathtt{arrhenius21.k}\left( t \right) - 2 \left( \mathtt{CH3O2}\left( t \right) \right)^{2} \mathtt{arrhenius16.k}\left( t \right) - \mathtt{CH3O2}\left( t \right) \mathtt{NO}\left( t \right) \mathtt{arrhenius15.k}\left( t \right) - \mathtt{CH3O2}\left( t \right) \mathtt{HO2}\left( t \right) \mathtt{arrhenius12.k}\left( t \right) + \mathtt{CH3OOH}\left( t \right) \mathtt{OH}\left( t \right) \mathtt{arrhenius13.k}\left( t \right) \\
\frac{\mathrm{d} \mathtt{CH2O}\left( t \right)}{\mathrm{d}t} &amp;=  - \mathtt{jCH2Oa} \mathtt{CH2O}\left( t \right) - \mathtt{jCH2Ob} \mathtt{CH2O}\left( t \right) + \mathtt{jCH3OOH} \mathtt{CH3OOH}\left( t \right) + 0.87 \mathtt{ISOP}\left( t \right) \mathtt{O3}\left( t \right) \mathtt{arrhenius21.k}\left( t \right) + 2 \left( \mathtt{CH3O2}\left( t \right) \right)^{2} \mathtt{arrhenius16.k}\left( t \right) + \mathtt{CH3O2}\left( t \right) \mathtt{NO}\left( t \right) \mathtt{arrhenius15.k}\left( t \right) - \mathtt{arrhenius11.k}\left( t \right) \mathtt{OH}\left( t \right) \mathtt{CH2O}\left( t \right) + \mathtt{arrhenius14.k}\left( t \right) \mathtt{CH3OOH}\left( t \right) \mathtt{OH}\left( t \right) \\
\frac{\mathrm{d} \mathtt{CO}\left( t \right)}{\mathrm{d}t} &amp;= \mathtt{jCH2Oa} \mathtt{CH2O}\left( t \right) + \mathtt{jCH2Ob} \mathtt{CH2O}\left( t \right) + 0.05 \mathtt{ISOP}\left( t \right) \mathtt{O3}\left( t \right) \mathtt{arrhenius21.k}\left( t \right) - \mathtt{rate\_OHCO10.k}\left( t \right) \mathtt{OH}\left( t \right) \mathtt{CO}\left( t \right) + \mathtt{arrhenius11.k}\left( t \right) \mathtt{OH}\left( t \right) \mathtt{CH2O}\left( t \right) \\
\frac{\mathrm{d} \mathtt{CH3OOH}\left( t \right)}{\mathrm{d}t} &amp;=  - \mathtt{jCH3OOH} \mathtt{CH3OOH}\left( t \right) + \mathtt{CH3O2}\left( t \right) \mathtt{HO2}\left( t \right) \mathtt{arrhenius12.k}\left( t \right) - \mathtt{arrhenius14.k}\left( t \right) \mathtt{CH3OOH}\left( t \right) \mathtt{OH}\left( t \right) - \mathtt{CH3OOH}\left( t \right) \mathtt{OH}\left( t \right) \mathtt{arrhenius13.k}\left( t \right) \\
\frac{\mathrm{d} \mathtt{ISOP}\left( t \right)}{\mathrm{d}t} &amp;=  - \mathtt{ISOP}\left( t \right) \mathtt{arrhenius18.k}\left( t \right) \mathtt{OH}\left( t \right) - \mathtt{ISOP}\left( t \right) \mathtt{O3}\left( t \right) \mathtt{arrhenius21.k}\left( t \right) \\
\frac{\mathrm{d} \mathtt{H2O2}\left( t \right)}{\mathrm{d}t} &amp;=  - \mathtt{jH2O2} \mathtt{H2O2}\left( t \right) - \mathtt{H2O2}\left( t \right) \mathtt{OH}\left( t \right) \mathtt{arrhenius5.k}\left( t \right) + \left( \mathtt{HO2}\left( t \right) \right)^{2} \mathtt{rate\_HO2HO24.k}\left( t \right) \\
\frac{\mathrm{d} \mathtt{HNO3}\left( t \right)}{\mathrm{d}t} &amp;= 0.5 \mathtt{H2O}\left( t \right) \mathtt{NO2}\left( t \right) \mathtt{rateconvert17.k}\left( t \right) + \mathtt{NO2}\left( t \right) \mathtt{arr\_3rdbody8.k}\left( t \right) \mathtt{OH}\left( t \right) \\
\mathtt{arrhenius1.k}\left( t \right) &amp;= \frac{\left( \frac{\mathtt{arrhenius1.K\_300}}{T} \right)^{\mathtt{arrhenius1.b0}} P \mathtt{arrhenius1.A} \mathtt{arrhenius1.a0} \mathtt{arrhenius1.ppb\_unit} e^{\frac{\mathtt{arrhenius1.c0}}{T}}}{T \mathtt{arrhenius1.R}} \\
\mathtt{arrhenius2.k}\left( t \right) &amp;= \frac{\left( \frac{\mathtt{arrhenius2.K\_300}}{T} \right)^{\mathtt{arrhenius2.b0}} P \mathtt{arrhenius2.A} \mathtt{arrhenius2.a0} \mathtt{arrhenius2.ppb\_unit} e^{\frac{\mathtt{arrhenius2.c0}}{T}}}{T \mathtt{arrhenius2.R}} \\
\mathtt{arrhenius3.k}\left( t \right) &amp;= \frac{\left( \frac{\mathtt{arrhenius3.K\_300}}{T} \right)^{\mathtt{arrhenius3.b0}} P \mathtt{arrhenius3.A} \mathtt{arrhenius3.a0} \mathtt{arrhenius3.ppb\_unit} e^{\frac{\mathtt{arrhenius3.c0}}{T}}}{T \mathtt{arrhenius3.R}} \\
\mathtt{rate\_HO2HO24.k}\left( t \right) &amp;= \left( 1 + \frac{1.4 \cdot 10^{-30} \left( \mathtt{H2O}\left( t \right) \right)^{2} P \mathtt{rate\_HO2HO24.A} \mathtt{rate\_HO2HO24.num\_density\_unit\_inv} \mathtt{rate\_HO2HO24.ppb\_inv} e^{\frac{\mathtt{rate\_HO2HO24.T\_0}}{T}}}{T \mathtt{rate\_HO2HO24.R}} \right) \left( \frac{P \mathtt{rate\_HO2HO24.A} \mathtt{rate\_HO2HO24.num\_density\_unit\_inv} \mathtt{rate\_HO2HO24.k1.k}\left( t \right)}{T \mathtt{rate\_HO2HO24.R}} + \mathtt{rate\_HO2HO24.k0.k}\left( t \right) \right) \\
\mathtt{rate\_HO2HO24.k0.k}\left( t \right) &amp;= \frac{\left( \frac{\mathtt{rate\_HO2HO24.k0.K\_300}}{T} \right)^{\mathtt{rate\_HO2HO24.k0.b0}} P \mathtt{rate\_HO2HO24.k0.A} \mathtt{rate\_HO2HO24.k0.a0} \mathtt{rate\_HO2HO24.k0.ppb\_unit} e^{\frac{\mathtt{rate\_HO2HO24.k0.c0}}{T}}}{T \mathtt{rate\_HO2HO24.k0.R}} \\
\mathtt{rate\_HO2HO24.k1.k}\left( t \right) &amp;= \frac{\left( \frac{\mathtt{rate\_HO2HO24.k1.K\_300}}{T} \right)^{\mathtt{rate\_HO2HO24.k1.b0}} P \mathtt{rate\_HO2HO24.k1.A} \mathtt{rate\_HO2HO24.k1.a0} \mathtt{rate\_HO2HO24.k1.ppb\_unit} e^{\frac{\mathtt{rate\_HO2HO24.k1.c0}}{T}}}{T \mathtt{rate\_HO2HO24.k1.R}} \\
\mathtt{arrhenius5.k}\left( t \right) &amp;= \frac{\left( \frac{\mathtt{arrhenius5.K\_300}}{T} \right)^{\mathtt{arrhenius5.b0}} P \mathtt{arrhenius5.A} \mathtt{arrhenius5.a0} \mathtt{arrhenius5.ppb\_unit} e^{\frac{\mathtt{arrhenius5.c0}}{T}}}{T \mathtt{arrhenius5.R}} \\
\mathtt{arrhenius6.k}\left( t \right) &amp;= \frac{\left( \frac{\mathtt{arrhenius6.K\_300}}{T} \right)^{\mathtt{arrhenius6.b0}} P \mathtt{arrhenius6.A} \mathtt{arrhenius6.a0} \mathtt{arrhenius6.ppb\_unit} e^{\frac{\mathtt{arrhenius6.c0}}{T}}}{T \mathtt{arrhenius6.R}} \\
\mathtt{arrhenius7.k}\left( t \right) &amp;= \frac{\left( \frac{\mathtt{arrhenius7.K\_300}}{T} \right)^{\mathtt{arrhenius7.b0}} P \mathtt{arrhenius7.A} \mathtt{arrhenius7.a0} \mathtt{arrhenius7.ppb\_unit} e^{\frac{\mathtt{arrhenius7.c0}}{T}}}{T \mathtt{arrhenius7.R}} \\
\mathtt{arr\_3rdbody8.k}\left( t \right) &amp;= \frac{0.6^{\frac{1}{1 + \left( \log_{10}\left( \frac{P \mathtt{arr\_3rdbody8.A} \mathtt{arr\_3rdbody8.num\_density\_unit\_inv} \mathtt{arr\_3rdbody8.alow.k}\left( t \right)}{T \mathtt{arr\_3rdbody8.R} \mathtt{arr\_3rdbody8.ahigh.k}\left( t \right)} \right) \right)^{2}}} P \mathtt{arr\_3rdbody8.A} \mathtt{arr\_3rdbody8.num\_density\_unit\_inv} \mathtt{arr\_3rdbody8.alow.k}\left( t \right)}{T \mathtt{arr\_3rdbody8.R} \left( 1 + \frac{P \mathtt{arr\_3rdbody8.A} \mathtt{arr\_3rdbody8.num\_density\_unit\_inv} \mathtt{arr\_3rdbody8.alow.k}\left( t \right)}{T \mathtt{arr\_3rdbody8.R} \mathtt{arr\_3rdbody8.ahigh.k}\left( t \right)} \right)} \\
\mathtt{arr\_3rdbody8.alow.k}\left( t \right) &amp;= \frac{\left( \frac{\mathtt{arr\_3rdbody8.alow.K\_300}}{T} \right)^{\mathtt{arr\_3rdbody8.alow.b0}} P \mathtt{arr\_3rdbody8.alow.A} \mathtt{arr\_3rdbody8.alow.a0} \mathtt{arr\_3rdbody8.alow.ppb\_unit} e^{\frac{\mathtt{arr\_3rdbody8.alow.c0}}{T}}}{T \mathtt{arr\_3rdbody8.alow.R}} \\
\mathtt{arr\_3rdbody8.ahigh.k}\left( t \right) &amp;= \frac{\left( \frac{\mathtt{arr\_3rdbody8.ahigh.K\_300}}{T} \right)^{\mathtt{arr\_3rdbody8.ahigh.b0}} P \mathtt{arr\_3rdbody8.ahigh.A} \mathtt{arr\_3rdbody8.ahigh.a0} \mathtt{arr\_3rdbody8.ahigh.ppb\_unit} e^{\frac{\mathtt{arr\_3rdbody8.ahigh.c0}}{T}}}{T \mathtt{arr\_3rdbody8.ahigh.R}} \\
\mathtt{arrhenius9.k}\left( t \right) &amp;= \frac{\left( \frac{\mathtt{arrhenius9.K\_300}}{T} \right)^{\mathtt{arrhenius9.b0}} P \mathtt{arrhenius9.A} \mathtt{arrhenius9.a0} \mathtt{arrhenius9.ppb\_unit} e^{\frac{\mathtt{arrhenius9.c0}}{T}}}{T \mathtt{arrhenius9.R}} \\
\mathtt{rate\_OHCO10.k}\left( t \right) &amp;= \frac{0.6^{\frac{1}{1 + \left( \log_{10}\left( \frac{P \mathtt{rate\_OHCO10.A} \mathtt{rate\_OHCO10.num\_density\_unit\_inv} \mathtt{rate\_OHCO10.klo2.k}\left( t \right)}{T \mathtt{rate\_OHCO10.R} \mathtt{rate\_OHCO10.khi2.k}\left( t \right)} \right) \right)^{2}}} \mathtt{rate\_OHCO10.klo2.k}\left( t \right)}{1 + \frac{P \mathtt{rate\_OHCO10.A} \mathtt{rate\_OHCO10.num\_density\_unit\_inv} \mathtt{rate\_OHCO10.klo2.k}\left( t \right)}{T \mathtt{rate\_OHCO10.R} \mathtt{rate\_OHCO10.khi2.k}\left( t \right)}} + \frac{0.6^{\frac{1}{1 + \left( \log_{10}\left( \frac{P \mathtt{rate\_OHCO10.A} \mathtt{rate\_OHCO10.num\_density\_unit\_inv} \mathtt{rate\_OHCO10.klo1.k}\left( t \right)}{T \mathtt{rate\_OHCO10.R} \mathtt{rate\_OHCO10.khi1.k}\left( t \right)} \right) \right)^{2}}} P \mathtt{rate\_OHCO10.A} \mathtt{rate\_OHCO10.num\_density\_unit\_inv} \mathtt{rate\_OHCO10.klo1.k}\left( t \right)}{T \mathtt{rate\_OHCO10.R} \left( 1 + \frac{P \mathtt{rate\_OHCO10.A} \mathtt{rate\_OHCO10.num\_density\_unit\_inv} \mathtt{rate\_OHCO10.klo1.k}\left( t \right)}{T \mathtt{rate\_OHCO10.R} \mathtt{rate\_OHCO10.khi1.k}\left( t \right)} \right)} \\
\mathtt{rate\_OHCO10.klo1.k}\left( t \right) &amp;= \frac{\left( \frac{\mathtt{rate\_OHCO10.klo1.K\_300}}{T} \right)^{\mathtt{rate\_OHCO10.klo1.b0}} P \mathtt{rate\_OHCO10.klo1.A} \mathtt{rate\_OHCO10.klo1.a0} \mathtt{rate\_OHCO10.klo1.ppb\_unit} e^{\frac{\mathtt{rate\_OHCO10.klo1.c0}}{T}}}{T \mathtt{rate\_OHCO10.klo1.R}} \\
\mathtt{rate\_OHCO10.khi1.k}\left( t \right) &amp;= \frac{\left( \frac{\mathtt{rate\_OHCO10.khi1.K\_300}}{T} \right)^{\mathtt{rate\_OHCO10.khi1.b0}} P \mathtt{rate\_OHCO10.khi1.A} \mathtt{rate\_OHCO10.khi1.a0} \mathtt{rate\_OHCO10.khi1.ppb\_unit} e^{\frac{\mathtt{rate\_OHCO10.khi1.c0}}{T}}}{T \mathtt{rate\_OHCO10.khi1.R}} \\
\mathtt{rate\_OHCO10.klo2.k}\left( t \right) &amp;= \frac{\left( \frac{\mathtt{rate\_OHCO10.klo2.K\_300}}{T} \right)^{\mathtt{rate\_OHCO10.klo2.b0}} P \mathtt{rate\_OHCO10.klo2.A} \mathtt{rate\_OHCO10.klo2.a0} \mathtt{rate\_OHCO10.klo2.ppb\_unit} e^{\frac{\mathtt{rate\_OHCO10.klo2.c0}}{T}}}{T \mathtt{rate\_OHCO10.klo2.R}} \\
\mathtt{rate\_OHCO10.khi2.k}\left( t \right) &amp;= \frac{\left( \frac{\mathtt{rate\_OHCO10.khi2.K\_300}}{T} \right)^{\mathtt{rate\_OHCO10.khi2.b0}} P \mathtt{rate\_OHCO10.khi2.A} \mathtt{rate\_OHCO10.khi2.a0} \mathtt{rate\_OHCO10.khi2.ppb\_unit} e^{\frac{\mathtt{rate\_OHCO10.khi2.c0}}{T}}}{T \mathtt{rate\_OHCO10.khi2.R}} \\
\mathtt{arrhenius11.k}\left( t \right) &amp;= \frac{\left( \frac{\mathtt{arrhenius11.K\_300}}{T} \right)^{\mathtt{arrhenius11.b0}} P \mathtt{arrhenius11.A} \mathtt{arrhenius11.a0} \mathtt{arrhenius11.ppb\_unit} e^{\frac{\mathtt{arrhenius11.c0}}{T}}}{T \mathtt{arrhenius11.R}} \\
\mathtt{arrhenius12.k}\left( t \right) &amp;= \frac{\left( \frac{\mathtt{arrhenius12.K\_300}}{T} \right)^{\mathtt{arrhenius12.b0}} P \mathtt{arrhenius12.A} \mathtt{arrhenius12.a0} \mathtt{arrhenius12.ppb\_unit} e^{\frac{\mathtt{arrhenius12.c0}}{T}}}{T \mathtt{arrhenius12.R}} \\
\mathtt{arrhenius13.k}\left( t \right) &amp;= \frac{\left( \frac{\mathtt{arrhenius13.K\_300}}{T} \right)^{\mathtt{arrhenius13.b0}} P \mathtt{arrhenius13.A} \mathtt{arrhenius13.a0} \mathtt{arrhenius13.ppb\_unit} e^{\frac{\mathtt{arrhenius13.c0}}{T}}}{T \mathtt{arrhenius13.R}} \\
\mathtt{arrhenius14.k}\left( t \right) &amp;= \frac{\left( \frac{\mathtt{arrhenius14.K\_300}}{T} \right)^{\mathtt{arrhenius14.b0}} P \mathtt{arrhenius14.A} \mathtt{arrhenius14.a0} \mathtt{arrhenius14.ppb\_unit} e^{\frac{\mathtt{arrhenius14.c0}}{T}}}{T \mathtt{arrhenius14.R}} \\
\mathtt{arrhenius15.k}\left( t \right) &amp;= \frac{\left( \frac{\mathtt{arrhenius15.K\_300}}{T} \right)^{\mathtt{arrhenius15.b0}} P \mathtt{arrhenius15.A} \mathtt{arrhenius15.a0} \mathtt{arrhenius15.ppb\_unit} e^{\frac{\mathtt{arrhenius15.c0}}{T}}}{T \mathtt{arrhenius15.R}} \\
\mathtt{arrhenius16.k}\left( t \right) &amp;= \frac{\left( \frac{\mathtt{arrhenius16.K\_300}}{T} \right)^{\mathtt{arrhenius16.b0}} P \mathtt{arrhenius16.A} \mathtt{arrhenius16.a0} \mathtt{arrhenius16.ppb\_unit} e^{\frac{\mathtt{arrhenius16.c0}}{T}}}{T \mathtt{arrhenius16.R}} \\
\mathtt{rateconvert17.k}\left( t \right) &amp;= \frac{P \mathtt{rateconvert17.A} \mathtt{rateconvert17.a0} \mathtt{rateconvert17.ppb\_unit}}{T \mathtt{rateconvert17.R}} \\
\mathtt{arrhenius18.k}\left( t \right) &amp;= \frac{\left( \frac{\mathtt{arrhenius18.K\_300}}{T} \right)^{\mathtt{arrhenius18.b0}} P \mathtt{arrhenius18.A} \mathtt{arrhenius18.a0} \mathtt{arrhenius18.ppb\_unit} e^{\frac{\mathtt{arrhenius18.c0}}{T}}}{T \mathtt{arrhenius18.R}} \\
\mathtt{arrhenius19.k}\left( t \right) &amp;= \frac{\left( \frac{\mathtt{arrhenius19.K\_300}}{T} \right)^{\mathtt{arrhenius19.b0}} P \mathtt{arrhenius19.A} \mathtt{arrhenius19.a0} \mathtt{arrhenius19.ppb\_unit} e^{\frac{\mathtt{arrhenius19.c0}}{T}}}{T \mathtt{arrhenius19.R}} \\
\mathtt{arrhenius20.k}\left( t \right) &amp;= \frac{\left( \frac{\mathtt{arrhenius20.K\_300}}{T} \right)^{\mathtt{arrhenius20.b0}} P \mathtt{arrhenius20.A} \mathtt{arrhenius20.a0} \mathtt{arrhenius20.ppb\_unit} e^{\frac{\mathtt{arrhenius20.c0}}{T}}}{T \mathtt{arrhenius20.R}} \\
\mathtt{arrhenius21.k}\left( t \right) &amp;= \frac{\left( \frac{\mathtt{arrhenius21.K\_300}}{T} \right)^{\mathtt{arrhenius21.b0}} P \mathtt{arrhenius21.A} \mathtt{arrhenius21.a0} \mathtt{arrhenius21.ppb\_unit} e^{\frac{\mathtt{arrhenius21.c0}}{T}}}{T \mathtt{arrhenius21.R}}
\end{align}
 \]</p><p>It&#39;s just an ODESystem, so we can run it like any other ModelingToolkit model:</p><pre><code class="language-julia hljs">using ModelingToolkit, OrdinaryDiffEq, Plots

sol = solve(ODEProblem(structural_simplify(chem)), tspan=(0,2*3600))

plot(sol, legend=:topright, xlabel=&quot;Time (s)&quot;, ylabel=&quot;Concentration (ppb)&quot;,
    title=&quot;SuperFast Chemistry&quot;)</code></pre><img src="70fea5ec.svg" alt="Example block output"/><h2 id="Coupling-Model-Components"><a class="docs-heading-anchor" href="#Coupling-Model-Components">Coupling Model Components</a><a id="Coupling-Model-Components-1"></a><a class="docs-heading-anchor-permalink" href="#Coupling-Model-Components" title="Permalink"></a></h2><p>EarthSciML model components differ from ordinary ModelingToolkit models in that they contain metadata that specifies how they should be coupled to other components. (In particular, this is done by specifying <code>:coupletype</code> metadata and the <code>EarthSciMLBase.couple2</code> function, which is covered in more detail <a href="https://base.earthsci.dev/dev/composition/">here</a>.) This allows us to use the <code>EarthSciMLBase.couple</code> function to couple model components together into a single model that can be run as a single unit, for example as shown below:</p><pre><code class="language-julia hljs">using EarthSciMLBase

chem_phot = couple(
    SuperFast(),
    FastJX()
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">CoupledSystem containing 2 system(s), 0 operator(s), and 0 callback(s).</code></pre><p>The above example couples the SuperFast with the <a href="https://gaschem.earthsci.dev/stable/api/#GasChem.FastJX-Tuple{}">Fast-JX</a> photolysis model, and when we run them together as a coupled model, we can see a characteristic diurnal cycle in the O‚ÇÉ concentration, were concentrations are lower at night and higher during the day owing to photochemistry:</p><pre><code class="language-julia hljs">chem_phot_sys = convert(ODESystem, chem_phot)
sol = solve(ODEProblem(chem_phot_sys), tspan=(0,3*24*3600))

plot(sol.t, sol[chem_phot_sys.SuperFast‚ÇäO3], legend=:topright, xlabel=&quot;Time (s)&quot;,
    ylabel=&quot;O‚ÇÉ Concentration (ppb)&quot;, label=:none,
    title=&quot;SuperFast Chemistry + Fast-JX Photolysis&quot;)</code></pre><img src="77825d8b.svg" alt="Example block output"/><h1 id="External-Data"><a class="docs-heading-anchor" href="#External-Data">External Data</a><a id="External-Data-1"></a><a class="docs-heading-anchor-permalink" href="#External-Data" title="Permalink"></a></h1><p>We can also bring in external data to provide forcing to our model using <a href="https://data.earthsci.dev">EarthSciData</a>. For example, below we load <a href="https://data.earthsci.dev/stable/geosfp/">GEOS-FP</a> meteorological data and pollutant emissions from the U.S. <a href="https://data.earthsci.dev/stable/nei2016/">National Emissions Inventory</a>.</p><pre><code class="language-julia hljs">using EarthSciData
using Dates

domain = DomainInfo(
    DateTime(2016, 5, 1),
    DateTime(2016, 5, 1, 6);
    lonrange = deg2rad(-115):deg2rad(2.5):deg2rad(-68.75),
    latrange = deg2rad(25):deg2rad(2):deg2rad(53.7),
    levrange = 1:15,
    dtype = Float64)

emis = NEI2016MonthlyEmis(&quot;mrggrid_withbeis_withrwc&quot;, domain; stream=false)
emis = EarthSciMLBase.copy_with_change(emis, discrete_events=[]) # Workaround for bug.

equations(emis)[1:5]</code></pre><p class="math-container">\[ \begin{align}
\mathtt{ACET}\left( t \right) &amp;= ifelse\left( \mathtt{lev} &lt; 2, \frac{\mathtt{ACET\_itp}\left( t, \mathtt{lon}, \mathtt{lat} \right)}{\mathtt{{\Delta}z}}, \mathtt{zero\_emis} \right) \\
\mathtt{ACROLEIN}\left( t \right) &amp;= ifelse\left( \mathtt{lev} &lt; 2, \frac{\mathtt{ACROLEIN\_itp}\left( t, \mathtt{lon}, \mathtt{lat} \right)}{\mathtt{{\Delta}z}}, \mathtt{zero\_emis} \right) \\
\mathtt{ALD2}\left( t \right) &amp;= ifelse\left( \mathtt{lev} &lt; 2, \frac{\mathtt{ALD2\_itp}\left( t, \mathtt{lon}, \mathtt{lat} \right)}{\mathtt{{\Delta}z}}, \mathtt{zero\_emis} \right) \\
\mathtt{ALD2\_PRIMARY}\left( t \right) &amp;= ifelse\left( \mathtt{lev} &lt; 2, \frac{\mathtt{ALD2\_PRIMARY\_itp}\left( t, \mathtt{lon}, \mathtt{lat} \right)}{\mathtt{{\Delta}z}}, \mathtt{zero\_emis} \right) \\
\mathtt{ALDX}\left( t \right) &amp;= ifelse\left( \mathtt{lev} &lt; 2, \frac{\mathtt{ALDX\_itp}\left( t, \mathtt{lon}, \mathtt{lat} \right)}{\mathtt{{\Delta}z}}, \mathtt{zero\_emis} \right)
\end{align}
 \]</p><pre><code class="language-julia hljs">geosfp = GEOSFP(&quot;0.5x0.625_NA&quot;, domain; stream=false)
geosfp = EarthSciMLBase.copy_with_change(geosfp, discrete_events=[]) # Workaround for bug.

equations(geosfp)[1:5]</code></pre><p class="math-container">\[ \begin{align}
\mathtt{A3dyn.DTRAIN}\left( t \right) &amp;= \mathtt{A3dyn.DTRAIN\_itp}\left( t, \mathtt{lon}, \mathtt{lat}, \mathtt{lev} \right) \\
\mathtt{A3dyn.OMEGA}\left( t \right) &amp;= \mathtt{A3dyn.OMEGA\_itp}\left( t, \mathtt{lon}, \mathtt{lat}, \mathtt{lev} \right) \\
\mathtt{A3dyn.RH}\left( t \right) &amp;= \mathtt{A3dyn.RH\_itp}\left( t, \mathtt{lon}, \mathtt{lat}, \mathtt{lev} \right) \\
\mathtt{A3dyn.U}\left( t \right) &amp;= \mathtt{A3dyn.U\_itp}\left( t, \mathtt{lon}, \mathtt{lat}, \mathtt{lev} \right) \\
\mathtt{A3dyn.V}\left( t \right) &amp;= \mathtt{A3dyn.V\_itp}\left( t, \mathtt{lon}, \mathtt{lat}, \mathtt{lev} \right)
\end{align}
 \]</p><p>In order to load data products, we will usually need to specify a spatiotemporal domain as demonstrated above. Simulations that don&#39;t include a spatial component will use data from the centerpoint of the provided spatial domain.</p><p>We can add our data providers to our model from above. We&#39;ll also add in other processes important to a simplified model of air quality, such as <a href="https://deposition.earthsci.dev/stable/">deposition</a>. The coupling process will automatically make the appropriate connections between the model components to build a unified model.</p><pre><code class="language-julia hljs">using AtmosphericDeposition

model = couple(
    SuperFast(),
    FastJX(),
    #DrydepositionG(), Not currently working
    Wetdeposition(),
    emis,
    geosfp,
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">CoupledSystem containing 5 system(s), 0 operator(s), and 0 callback(s).</code></pre><h2 id="Box-Model-Simulation"><a class="docs-heading-anchor" href="#Box-Model-Simulation">Box Model Simulation</a><a id="Box-Model-Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Box-Model-Simulation" title="Permalink"></a></h2><p>Once we specify our model, we can try running it in a zero-dimensional &quot;box model&quot; format.  This can allow us study the dynamics or diagnose any programs without using a lot of computing power.</p><pre><code class="language-julia hljs">model_sys = convert(ODESystem, model)
sol = solve(ODEProblem(model_sys), Rosenbrock23(autodiff=false), tspan=BigFloat.(get_tspan(domain)))

plot(unix2datetime.(sol.t), sol[model_sys.SuperFast‚ÇäO3],
    ylabel=&quot;O‚ÇÉ Concentration (ppb)&quot;,
    xlabel=&quot;Time&quot;, label=:none,
    title=&quot;Air Quality Box Model&quot;)</code></pre><img src="c7c907c1.svg" alt="Example block output"/><h2 id="3D-Model-Simulation"><a class="docs-heading-anchor" href="#3D-Model-Simulation">3D Model Simulation</a><a id="3D-Model-Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#3D-Model-Simulation" title="Permalink"></a></h2><p>Once we&#39;re satisfied with our box model, we can move on to a full 3D simulation. To do this, we&#39;ll add in any spatial operators that we&#39;ll need, for example <a href="https://transport.earthsci.dev/stable/advection/">advection</a> from the <a href="https://transport.earthsci.dev/stable/">EnvironmentalTransport</a> package. We can also add in a model component that will <a href="https://data.earthsci.dev/dev/api/#EarthSciData.NetCDFOutputter">write the model results to the disk</a>, which can be useful for large simulations where the results may not all fit in the memory of your computer. Finally, we also need to add our spatiotemporal domain to the model.</p><pre><code class="language-julia hljs">using EnvironmentalTransport

dt = 300.0 # Operator splitting timestep
advection = AdvectionOperator(dt, upwind1_stencil, ZeroGradBC())

outfile = (&quot;RUNNER_TEMP&quot; ‚àà keys(ENV) ? ENV[&quot;RUNNER_TEMP&quot;] : tempname()) * &quot;out.nc&quot; # This is just a location to save the output.
output = NetCDFOutputter(outfile, 3600.0) # Save output every 3600 sec. of simulation time,

model_3d = couple(model, advection, output, domain)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">CoupledSystem containing 5 system(s), 1 operator(s), and 1 callback(s).</code></pre><h3 id="Graph-Visualization"><a class="docs-heading-anchor" href="#Graph-Visualization">Graph Visualization</a><a id="Graph-Visualization-1"></a><a class="docs-heading-anchor-permalink" href="#Graph-Visualization" title="Permalink"></a></h3><p>Once we&#39;ve created our model, we can also check a graph representation of its components. This shows each of the components in the model as nodes and couplings between the components as edges.</p><pre><code class="language-julia hljs">using MetaGraphsNext
using CairoMakie, GraphMakie

g = graph(model_3d)
f = Figure(backgroundcolor = :transparent)
ax = Axis(f[1, 1], backgroundcolor = :transparent)
p = graphplot!(ax, g; ilabels=labels(g), edge_color=:gray)
CairoMakie.xlims!(ax, -2.4, 1.5)
CairoMakie.ylims!(ax, -2.3, 2.5)
hidedecorations!(ax); hidespines!(ax)
f</code></pre><img src="56c4e5d1.png" alt="Example block output"/><p>So for example in the figure above we can see that <code>WetDeposition</code> is coupled to SuperFast (because it is depositing the SuperFast chemical species) and to GEOS-FP (because it gets information such as Temperature and cloud fraction from GEOS-FP).</p><h3 id="Running-3D-simulation"><a class="docs-heading-anchor" href="#Running-3D-simulation">Running 3D simulation</a><a id="Running-3D-simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Running-3D-simulation" title="Permalink"></a></h3><p>Running a 3D simulation is similar to running the box model simulation, except we need to specify a <a href="https://base.earthsci.dev/stable/api/#EarthSciMLBase.SolverStrategy">SolverStrategy</a> which will tell the solver how to combine the non-spatial and spatial components of the model. Here we will use <a href="https://base.earthsci.dev/stable/api/#EarthSciMLBase.SolverStrangSerial">SolverStrangSerial</a>.</p><p>We then use our solver strategy as an argument to <code>ODEProblem</code>. We also specify some options in <code>solve</code> show a progress bar (because this simulation can take a while) and to prevent the output data from being saved in memory because we have already specified that we want to save it to disk instead.</p><pre><code class="language-julia hljs">st = SolverStrangSerial(Rosenbrock23(autodiff=false), dt)

prob = ODEProblem(model_3d, st; tspan=BigFloat.(get_tspan(domain)))

using ProgressLogging # Needed for progress bar. Use `TerminalLoggers` if in a terminal.

sol = solve(prob, SSPRK22(); dt=dt, progress=true, progress_steps=1,
    save_on=false, save_start=false, save_end=false, initialize_save=false)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">retcode: Success
Interpolation: 3rd order Hermite
t: BigFloat[]
u: Vector{Float64}[]</code></pre><h3 id="Visualizing-3D-model-results"><a class="docs-heading-anchor" href="#Visualizing-3D-model-results">Visualizing 3D model results</a><a id="Visualizing-3D-model-results-1"></a><a class="docs-heading-anchor-permalink" href="#Visualizing-3D-model-results" title="Permalink"></a></h3><p>Because we have saved our results to disk instead of in the <code>sol</code> variable, we need to visualize differently than we have above. To do so, we can use the <a href="https://juliageo.org/NCDatasets.jl/stable/">NCDatasets</a> package.</p><pre><code class="language-julia hljs">using NCDatasets

ds = NCDataset(outfile, &quot;r&quot;);

cross_section_lat = size(ds[&quot;SuperFast‚ÇäO3&quot;], 2) √∑ 2
anim = @animate for i ‚àà 1:size(ds[&quot;SuperFast‚ÇäO3&quot;])[4]
    Plots.plot(
        Plots.heatmap(ds[&quot;SuperFast‚ÇäO3&quot;][:, :, 1, i]&#39;, title=&quot;Ground-Level&quot;),
        Plots.heatmap(ds[&quot;SuperFast‚ÇäO3&quot;][:, cross_section_lat, :, i]&#39;,
            title=&quot;Vertical Cross-Section&quot;),
        size=(1200, 400)
    )
end
gif(anim, fps = 5)</code></pre><img src="80930852.gif" alt="Example block output"/><h2 id="Next-Steps"><a class="docs-heading-anchor" href="#Next-Steps">Next Steps</a><a id="Next-Steps-1"></a><a class="docs-heading-anchor-permalink" href="#Next-Steps" title="Permalink"></a></h2><p>Now that you have a basic understanding of how to use EarthSciML, you can take a look at the model components and features available in the different <a href="../../libraries/overview/#Available-Software-Libraries">Available Software Libraries</a> that we provide.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../using_mtk/">¬´ Using ModelingToolkit</a><a class="docs-footer-nextpage" href="../../examples/overview/">Overview ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Sunday 26 January 2025 19:46">Sunday 26 January 2025</span>. Using Julia version 1.11.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
